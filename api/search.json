[{"id":"8c86b39e74b792721702587f520ee80d","title":"Istio 无法支持 HTTP1.0 和访问接口存在延迟的解决办法","content":"现象Rancher 通过 RKE 部署了 K8S 集群后,启动了 Istio,由于一些项目使用的事 HTTP/1.0协议,访问出现问题. Istio 默认只支持 HTTP/1.1 以上协议版本，并不支持 HTTP/1.0。\n原因Istio 默认不支持 HTTP1.0 协议\nIstio 配置参考\n\n解决办法修改环境变量 PILOT_HTTP10 为 1,即可增加对 HTTP1.0的支持。\nRancher 部署的ISTIO\n主要方式是修改 环境变量的值.修改Deployments 中 istiod 资源的配置.增加环境变量 PILOT_HTTP10的值为 1 即可.\n\n结果修改后 HTTP1.0已经可以支持了.但是出现了另外的问题.访问接口的时候出现了超时.所有接口访问速度都增加了大概 1 秒的样子.\n解决 1 秒问题查阅 Envoy的文档后发现,\nEnvory相关配置地址\n\n修改改配置为 0 可以解决这个 1 秒延迟的问题.\n\n创建以下 disable-close-timeout.yaml 并配置到 kubernetes 集群 : kubectl apply -f disable-close-timeout.yaml -n istio-system\napiVersion: networking.istio.io&#x2F;v1alpha3\nkind: EnvoyFilter\nmetadata:\n  name: custom-protocol\n  namespace: istio-system\nspec:\n  configPatches:\n  - applyTo: NETWORK_FILTER\n    match:\n      listener:\n        filterChain:\n          filter:\n            name: envoy.filters.network.http_connection_manager\n    patch:\n      operation: MERGE\n      value:\n        name: envoy.filters.network.http_connection_manager\n        typed_config:\n          &#39;@type&#39;: type.googleapis.com&#x2F;envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager\n          delayed_close_timeout: &quot;0&quot;\n\n","slug":"Istio无法支持-HTTP1-0-和访问接口存在延迟的解决办法","date":"2022-08-10T06:24:00.000Z","categories_index":"Kubernetes","tags_index":"RKE,Rancher,Istio,HTTP,Kubernetes,Envoy","author_index":"tusimo"},{"id":"f73a8e23e6f6f669cf99c7dba8fa0722","title":"","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server$ hexo server\n\nMore info: Server\nGenerate static files$ hexo generate\n\nMore info: Generating\nDeploy to remote sites$ hexo deploy\n\nMore info: Deployment\n","slug":"hello-world","date":"2022-08-08T13:35:00.000Z","categories_index":"","tags_index":"","author_index":"tusimo"}]